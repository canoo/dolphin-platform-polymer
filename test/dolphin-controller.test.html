<script src="../bower_components/webcomponentsjs/webcomponents-loader.js"></script>
<script src="../bower_components/web-component-tester/browser.js"></script>
<link rel="import" href="../dolphin-controller.html">

<test-fixture id="simple-controller">
  <template>
    <dolphin-controller name="fooController"></dolphin-controller>
  </template>
</test-fixture>

<script>
  suite("<dolphin-controller>", () => {

    const dolphinContext = {
      beanManager: {
        onBeanUpdate: (callback) => { },
        onArrayUpdate: (callback) => { },
        notifyBeanChange: () => { },
        notifyArrayChange: () => { },
      },
      createController: (name) => {
        return Promise.resolve({
          model: {},
          onDestroyed: () => { }
        })
      }
    }

    test("create controller", done => {
      // given:
      const controller = fixture("simple-controller")
      controller.dolphinContext = dolphinContext

      // when:
      controller.create()
      expect(controller.state).to.equal("INITIALIZING")

      // then:
      flush(() => {
        expect(controller.state).to.equal("READY")
        done()
      })
    })

    // test("destroy controller", done => {
    //   // given:
    //   const controller = fixture("simple-controller")
    //   controller.dolphinContext = dolphinContext

    //   // when:
    //   controller.create()
    //   controller.destroy()

    //   // then:
    //   flush(() => {
    //     expect(controller.state).to.equal("DESTROYED")
    //     done()
    //   })
    // })

    test("change controller model", done => {
      // given:
      const controller = fixture("simple-controller")
      controller.dolphinContext = dolphinContext
      controller.create()

      // when:
      flush(() => {
        controller.set("model", { bean: "foo" })
        controller.set("model.bean", "bar")
        controller.set("model.array", [])
        controller.set("model.array", [1, 2, 3, 4])
        controller.splice("model.array", 1, 2, ...[9])

        // then:
        expect(controller.model).to.deep.equal({ array: [1, 9, 4], bean: "bar" })
        done()
      })
    })

  })
</script>