<script src="../bower_components/webcomponentsjs/webcomponents-loader.js"></script>
<script src="../bower_components/web-component-tester/browser.js"></script>
<link rel="import" href="../dolphin-controller.html">

<test-fixture id="simple-fixture">
  <template>
    <dolphin-controller></dolphin-controller>
  </template>
</test-fixture>

<script>
  const dolphinContext = {
    beanManager: {
      onBeanUpdate: (callback) => { },
      onArrayUpdate: (callback) => { },
      notifyBeanChange: () => { },
      notifyArrayChange: () => { },
    },
    createController: (name) => {
      return Promise.resolve({
        model: {},
        onDestroyed: () => { }
      })
    }
  }
  const controllerName = "fooController"

  suite("<dolphin-controller>", () => {

    test("change dolphin context and controller name", done => {
      // given:
      const element = fixture("simple-fixture")

      // when:
      element.dolphinContext = dolphinContext
      element.name = controllerName
      expect(element.state).to.equal("INITIALIZING")

      // then:
      flush(() => {
        expect(element.state).to.equal("READY")
        done()
      })
    })

    test("change controller model", done => {
      // given:
      const element = fixture("simple-fixture")
      element.dolphinContext = dolphinContext
      element.name = controllerName

      // when:
      flush(() => {
        element.set("model", { bean: "foo" })
        element.set("model.bean", "bar")
        element.set("model.array", [])
        element.set("model.array", [1, 2, 3, 4])
        element.splice("model.array", 1, 2, ...[9])

        // then:
        expect(element.model).to.deep.equal({ array: [1, 9, 4], bean: "bar" })
        done()
      })
    })

  })
</script>